# Lecture 19 â€” Query Optimization

Activity: inside `flipped/L19`, there are two tables, `customer` and `orders`. I
would like to know

* Names of customers who live in New York and who have at least one order with over
  5000 dollars.

My query after parsing and translation is (*query execution plan*)

* scan `customer` table then do a join (assuming [nested loop
  join](https://en.wikipedia.org/wiki/Nested_loop_join) to make it simple) with
  `orders` table using `customer_id`
* filter records where `city = "New York"`
* filter records where `purchase_amount > 5000`
* return `distinct customer_name` of those records

How do you optimize it?

* only look at the tables?
* what if we have an index? Is it usable?
* how about making use of the statistics?

Question: what is the overhead?

## Join Elimination

```SQL
SELECT c.* FROM customer AS c JOIN address AS a ON c.address_id = a.address_id;
```

The above `join` can be eliminated if there is a right foreign key (which means
the constraint is already met)

## Evaluation Plan Selection

* Focus on the `join` operation
* Generating alternatives
* Nested subqueries

## Guidelines

* Do stuff early
* Set limits
* Plan caching
